"use strict";for(var soundArr=[],soundNote=[1,1.5,2,2.5,3,4,4.5,5,5.5,6,6.5,7,8,8.5,9,9.5,10,11,11.5,12,12.5,13,13.5,14,15],i=0;i<soundNote.length;i++)soundArr.push({number:soundNote[i],url:"https://awiclass.monoame.com/pianosound/set/"+soundNote[i]+".wav"});var sheetMusic=[{num:5,time:210},{num:1,time:382},{num:2,time:474},{num:3,time:564},{num:4,time:655},{num:5,time:763},{num:1,time:934},{num:1,time:1114},{num:6,time:1294},{num:4,time:1472},{num:5,time:1554},{num:6,time:1648},{num:7,time:1738},{num:8,time:1828},{num:1,time:1998},{num:1,time:2182}],sheetMusic2=[{num:3,time:105},{num:3,time:223},{num:4,time:331},{num:5,time:482},{num:5,time:565},{num:4,time:673},{num:3,time:782},{num:2,time:893},{num:1,time:1006},{num:1,time:1113},{num:2,time:1220},{num:3,time:1337},{num:3,time:1456},{num:2,time:1623},{num:2,time:1680},{num:3,time:1883},{num:3,time:1988},{num:4,time:2107},{num:5,time:2218},{num:5,time:2337},{num:4,time:2446},{num:3,time:2555},{num:2,time:2664},{num:1,time:2771},{num:1,time:2880},{num:2,time:2992},{num:3,time:3103},{num:2,time:3220},{num:1,time:3395},{num:1,time:3449}],keyArr=[{num:1,key:90,type:"white"},{num:1.5,key:83,type:"black"},{num:2,key:88,type:"white"},{num:2.5,key:68,type:"black"},{num:3,key:67,type:"white"},{num:4,key:86,type:"white"},{num:4.5,key:71,type:"black"},{num:5,key:66,type:"white"},{num:5.5,key:72,type:"black"},{num:6,key:78,type:"white"},{num:6.5,key:74,type:"black"},{num:7,key:77,type:"white"},{num:8,key:69,type:"white"},{num:8.5,key:52,type:"black"},{num:9,key:82,type:"white"},{num:9.5,key:53,type:"black"},{num:10,key:84,type:"white"},{num:11,key:89,type:"white"},{num:11.5,key:55,type:"black"},{num:12,key:85,type:"white"},{num:12.5,key:56,type:"black"},{num:13,key:73,type:"white"},{num:13.5,key:57,type:"black"},{num:14,key:79,type:"white"},{num:15,key:80,type:"white"}],box=new Vue({el:"#piano",data:{soundData:soundArr,notes:sheetMusic,nowNote:0,nextNote:0,playingTime:0,musicPlayer:null,pianoKeys:keyArr,pressKeyCode:0,recordTime:0,recordPlayer:null},computed:{},methods:{soundPlay:function(e,t){if(e>0){var i=$("audio[data-num='"+e+"']")[0];i.currentTime=0,i.volume=t,i.play()}this.recordTime>0&&this.notes.push({num:e,time:this.recordTime})},playNext:function(e){var t=this.notes[this.nowNote].num;this.soundPlay(t,e),this.nowNote+=1,this.nowNote>this.notes.length&&this.stopPlay(),this.nowNote==this.notes.length&&(clearInterval(this.musicPlayer),this.nextNote=0,this.playingTime=0)},startPlay:function(){this.nowNote=0,this.nextNote=0,this.playingTime=0,this.musicPlayer=setInterval(function(){box.playingTime+=1,box.playingTime>=box.notes[box.nextNote].time&&(box.playNext(1),box.nextNote+=1,$(".startRc").attr("disabled","true"),$(".startRc").addClass("disable"),$(".clear").attr("disabled","true"),$(".clear").addClass("disable"),$(".sample1").attr("disabled","true"),$(".sample1").addClass("disable"),$(".sample2").attr("disabled","true"),$(".sample2").addClass("disable"),0==box.playingTime&&($("button").removeAttr("disabled","true"),$("button").removeClass("disable")))})},stopPlay:function(){clearInterval(this.musicPlayer),this.nowNote=0,this.nextNote=0,this.playingTime=0,$("button").removeAttr("disabled","true"),$("button").removeClass("disable")},currentPlayNote:function(e,t){if(0==this.notes.length)return!1;var i=this.nowNote-1;return i<=0&&(i=0),t==this.pressKeyCode||(this.notes[i].num==e&&this.playingTime>0||void 0)},clearNotes:function(){this.stopPlay(),this.notes=[],$(".play").attr("disabled","true"),$(".play").addClass("disable")},sampleNotes1:function(){this.notes=sheetMusic2,$(".play").removeAttr("disabled","true"),$(".play").removeClass("disable")},sampleNotes2:function(){$.ajax({url:"https://awiclass.monoame.com/api/command.php?type=get&name=music_star",success:function(e){box.notes=JSON.parse(e)}}),$(".play").removeAttr("disabled","true"),$(".play").removeClass("disable")},startRecord:function(){this.recordTime=0,this.clearNotes(),this.recordPlayer=setInterval(function(){box.recordTime+=1}),$(".play").attr("disabled","true"),$(".play").addClass("disable"),$(".sample1").attr("disabled","true"),$(".sample1").addClass("disable"),$(".sample2").attr("disabled","true"),$(".sample2").addClass("disable")},stopRecord:function(){clearInterval(this.recordPlayer),this.recordTime=0,$("button").removeAttr("disabled","true"),$("button").removeClass("disable"),this.noNotes()},noNotes:function(){0==this.notes.length&&($(".play").attr("disabled","true"),$(".play").addClass("disable"))}}});$(window).keydown(function(e){var t=e.which;box.pressKeyCode=t;for(var i=0;i<box.pianoKeys.length;i++)t==box.pianoKeys[i].key&&box.soundPlay(box.pianoKeys[i].num,1)}),$(window).keyup(function(){box.pressKeyCode=0});